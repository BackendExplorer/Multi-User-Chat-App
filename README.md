# ğŸŒ ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒãƒ£ãƒƒãƒˆã‚µãƒ¼ãƒ“ã‚¹ ğŸ’¬  

ãƒ¦ãƒ¼ã‚¶ãŒãƒ«ãƒ¼ãƒ ã‚’ä½œæˆã¾ãŸã¯å‚åŠ ã—ã¦ã€ã‚°ãƒ«ãƒ¼ãƒ—ãƒãƒ£ãƒƒãƒˆãŒã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹



## ğŸ–¥ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³








## ğŸ“Œ ç›®æ¬¡
**ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ç›®æ¬¡ã§ã™ã€‚å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¸ã‚¸ãƒ£ãƒ³ãƒ—ã§ãã¾ã™ã€‚**

<hr style="border: 3px solid black;">

## **ğŸ“ æ¦‚è¦**
- [æ¦‚è¦](#æ¦‚è¦)
- [ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³](#ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)
- [å®Ÿè¡Œæ–¹æ³•](#å®Ÿè¡Œæ–¹æ³•)

---

## **ğŸ›  æŠ€è¡“é–¢é€£**
- [ä½¿ç”¨æŠ€è¡“](#ä½¿ç”¨æŠ€è¡“)
- [æ©Ÿèƒ½ä¸€è¦§](#æ©Ÿèƒ½ä¸€è¦§)
- [ã‚¯ãƒ©ã‚¹å›³](#ã‚¯ãƒ©ã‚¹å›³)
- [å‡¦ç†ãƒ•ãƒ­ãƒ¼ (ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ)](#å‡¦ç†ãƒ•ãƒ­ãƒ¼)

---

## **ğŸ“é–‹ç™ºã®ãƒã‚¤ãƒ³ãƒˆ**
- [ã“ã ã‚ã‚Šã®ãƒã‚¤ãƒ³ãƒˆ](#ã“ã ã‚ã‚Šã®ãƒã‚¤ãƒ³ãƒˆ)
- [è‹¦åŠ´ã—ãŸç‚¹](#è‹¦åŠ´ã—ãŸç‚¹)
- [ã•ã‚‰ã«è¿½åŠ ã—ãŸã„æ©Ÿèƒ½](#ã•ã‚‰ã«è¿½åŠ ã—ãŸã„æ©Ÿèƒ½)

---

## **ğŸ“„ å‚è€ƒæƒ…å ±**
- [å‚è€ƒæ–‡çŒ®](#å‚è€ƒæ–‡çŒ®)

---

## ğŸ–¥ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

## â–¶ï¸ å®Ÿè¡Œæ–¹æ³•

## ğŸ›  ä½¿ç”¨æŠ€è¡“

| ã‚«ãƒ†ã‚´ãƒª | æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ |
|----------|------------|
| é–‹ç™ºè¨€èª | Python 3.13.2 |
| ã‚¤ãƒ³ãƒ•ãƒ© | Docker |
| ãã®ä»– | Git, GitHub |


## âš™ æ©Ÿèƒ½ä¸€è¦§


## ğŸ”€å‡¦ç†ãƒ•ãƒ­ãƒ¼ (ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ)

```mermaid
%%{init: {'themeVariables': {'scale': 0.5}}}%%
graph TD
    A[CLIèµ·å‹•] --> B[ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶š]
    B -->|ãƒ«ãƒ¼ãƒ ä½œæˆ| C[ãƒ«ãƒ¼ãƒ åã‚’å…¥åŠ›]
    B -->|ãƒ«ãƒ¼ãƒ å‚åŠ | D[ãƒ«ãƒ¼ãƒ ä¸€è¦§ã‚’å–å¾— â†’ ãƒ«ãƒ¼ãƒ ã‚’é¸æŠ]
    
    C --> E[ãƒãƒ£ãƒƒãƒˆé–‹å§‹]
    D --> E
    
    E -->|ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡| F[ä»–ã®å‚åŠ è€…ã«é€ä¿¡]
    F -->|ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡| E
    
    E -->|é€€å‡º| G[ãƒ—ãƒ­ã‚°ãƒ©ãƒ çµ‚äº†]
```



```mermaid
graph TD

classDef server fill:#e3f2fd,stroke:#1e88e5,stroke-width:2px
classDef client fill:#e8f5e9,stroke:#2e7d32,stroke-width:2px
classDef messaging fill:#ede7f6,stroke:#6a1b9a,stroke-width:2px
classDef warning fill:#ffebee,stroke:#c62828,stroke-width:2px

subgraph Server Startup
    A1(Main Thread)
    A2(TCP Server Thread)
    A3(UDP Server Thread)
    A4(Client Connection Accepted)
    A5(Register Client)
    A6(Message Thread)
    A7(Monitor Thread)

    A1 -->|Start TCP Server| A2
    A1 -->|Start UDP Server| A3
    A2 -->|Waiting for Client| A4
    A4 -->|Create/Join Room| A5
    A3 -->|Message Handling| A6
    A3 -->|Inactive Monitoring| A7

    class A1,A2,A3,A4,A5,A6,A7 server
end

subgraph Client Startup
    B1(Client Run)
    B2(TCP Client)
    B3(Connection Success)
    B4(Get Username)
    B5(Create or Join Room)
    B6(Create Room Process)
    B7(Receive Token)
    B8(Join Room Process)
    B9(Receive Token)
    B10(UDP Client)
    B11(Start Chat)

    B1 -->|Start TCP Client| B2
    B2 -->|Connect Server| B3
    B3 -->|Enter Username| B4
    B4 -->|Select Operation| B5
    B5 -->|Create Room| B6
    B6 -->|Send to Server| B7
    B5 -->|Join Room| B8
    B8 -->|Send to Server| B9
    B2 -->|Start UDP Client| B10
    B10 -->|Send Room Info| B11

    class B1,B2,B3,B4,B5,B6,B7,B8,B9,B10,B11 client
end

subgraph Server Message Handling
    C1(UDP Server)
    C2(Receive from Client)
    C3(Broadcast to Room)
    C4(Inactive Check)
    C5(Kick & Manage Room)

    C1 -->|Receive Message| C2
    C2 -->|Parse & Broadcast| C3
    C1 -->|Monitor Inactivity| C4
    C4 -->|Timeout| C5

    class C1,C2,C3,C4,C5 messaging
end

subgraph Client Exit
    D1(Client)
    D2(UDP 'exit!')
    D3(Program End)
    D4(Timeout Removal)
    D5(Server Management)

    D1 -->|User typed exit| D2
    D2 -->|Close Socket| D3
    D1 -->|Server Timeout Notice| D4
    D4 -->|Delete Room or Notify| D5

    class D1,D2,D3,D4,D5 warning
end

A1 --> B1
B1 --> C1
C1 --> D1
```

## ğŸ“¦ ã‚¯ãƒ©ã‚¹å›³ã¨æ§‹æˆ


ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€**TCP/UDPé€šä¿¡ã‚’ç”¨ã„ãŸãƒãƒ£ãƒƒãƒˆã‚·ã‚¹ãƒ†ãƒ ** ã‚’æ§‹æˆã™ã‚‹ã‚¯ãƒ©ã‚¹ç¾¤ã§æˆã‚Šç«‹ã£ã¦ã„ã¾ã™ã€‚ã‚µãƒ¼ãƒãƒ¼ã¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§ãã‚Œãã‚Œã®å½¹å‰²ã‚’æŒã¡ã€ä»¥ä¸‹ã®ã‚ˆã†ã«åˆ†é¡ã•ã‚Œã¾ã™ã€‚





### ğŸ“ server.py ã®ã‚¯ãƒ©ã‚¹å›³
```mermaid
%%{init: {'themeVariables': {'scale': 0.3}}}%%
classDiagram
direction LR

TCPServer -- UDPServer

class TCPServer {
    - HEADER_MAX_BYTE: int
    - TOKEN_MAX_BYTE: int
    - server_address: str
    - server_port: int
    - sock: socket
    - room_members_map: dict
    - clients_map: dict
    + __init__(server_address: str, server_port: int)
    + start_tcp_server(): None
    - accept_tcp_connections(): None
    - handle_client_request(connection: socket, client_address: tuple): None
    - decode_message(data: bytes): tuple
    - register_client(token: bytes, client_address: tuple, room_name: str, payload: str, operation: int): None
    - create_room(connection: socket, room_name: str, payload: str, token: bytes): None
    - join_room(connection: socket, room_name: str, payload: str, token: bytes): None
}

class UDPServer {
    - server_address: str
    - server_port: int
    - room_members_map: dict
    - clients_map: dict
    - sock: socket
    + __init__(server_address: str, server_port: int)
    + start_udp_server(): None
    - handle_messages(): None
    - decode_message(data: bytes): tuple
    - broadcast_message(room_name: str, message: str): None
    - remove_inactive_clients(): None
    - disconnect_inactive_client(client_token: bytes, client_info: list): None
}
```

### ğŸ“ client.py ã®ã‚¯ãƒ©ã‚¹å›³
```mermaid
%%{init: {'themeVariables': {'scale': 0.05}}}%%
classDiagram
direction LR

TCPClient -- UDPClient

class TCPClient {
    - server_address: str
    - server_port: int
    - sock: socket
    - client_info: dict
    + __init__(server_address: str, server_port: int)
    + start_tcp_client(): dict
    - connect_to_server(): None
    - input_user_name(): str
    - input_operation(): int
    - create_room(username: str): tuple
    - input_room_name(operation: int): str
    - create_packet(room_name: str, operation: int, state: int, payload: str): bytes
    - create_header(room_name: str, operation: int, state: int, payload: str): bytes
    - join_room(username: str): tuple
}

class UDPClient {
    - server_address: str
    - server_port: int
    - sock: socket
    - my_info: dict
    - my_token: bytes
    - room_name: str
    + __init__(server_address: str, server_port: int, my_info: dict)
    + start_udp_chat(): None
    - send_username(): None
    - send_message(): None
    - receive_message(): None
    - create_packet(message: bytes = b"" ): bytes
}
```

---



### ğŸ–¥ ã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
ã‚µãƒ¼ãƒãƒ¼å´ã®ã‚¯ãƒ©ã‚¹ã¯ã€**ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®æ¥ç¶šç®¡ç†ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†ã€ãƒ«ãƒ¼ãƒ ç®¡ç†** ãªã©ã‚’æ‹…å½“ã—ã¾ã™ã€‚

#### ğŸ”¹ TCPServer

TCPé€šä¿¡ã‚’ä»‹ã—ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã€é©åˆ‡ãªå‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

| æ©Ÿèƒ½ | èª¬æ˜ |
|------|------|
| ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®æ¥ç¶šå—ä»˜ | `start_tcp_server()` |
| ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç† | `handle_client_request()` |
| ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæƒ…å ±ã®ç™»éŒ² | `register_client()` |
| ãƒ«ãƒ¼ãƒ ã®ä½œæˆ | `create_room()` |
| ãƒ«ãƒ¼ãƒ ã¸ã®å‚åŠ  | `join_room()` |
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è§£æ | `decode_message()` |

#### ğŸ”¹ UDPServer

UDPé€šä¿¡ã‚’ä»‹ã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã—ã€ãƒªãƒ¬ãƒ¼ã¾ãŸã¯é©åˆ‡ãªå‡¦ç†ã‚’è¡Œã„ã¾ã™ã€‚

| æ©Ÿèƒ½ | èª¬æ˜ |
|------|------|
| ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡ | `handle_messages()` |
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å‡¦ç† | `decode_message()` |
| ãƒ«ãƒ¼ãƒ å†…ã®ãƒ¡ãƒ³ãƒãƒ¼ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ | `broadcast_message()` |
| éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®å‰Šé™¤ | `remove_inactive_clients()` |

---

### ğŸ’» ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ—ãƒ­ã‚°ãƒ©ãƒ 
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã‚¯ãƒ©ã‚¹ã¯ã€**ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã€ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€å—ä¿¡ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹** ã‚’æ‹…å½“ã—ã¾ã™ã€‚

#### ğŸ”¹ TCPClient

TCPé€šä¿¡ã‚’ä»‹ã—ã¦ã‚µãƒ¼ãƒãƒ¼ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã—ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ä¿¡ã—ã¾ã™ã€‚

| æ©Ÿèƒ½ | èª¬æ˜ |
|------|------|
| ã‚µãƒ¼ãƒãƒ¼æ¥ç¶š | `connect_to_server()` |
| ãƒ«ãƒ¼ãƒ ã®ä½œæˆ | `create_room()` |
| ãƒ«ãƒ¼ãƒ ã¸ã®å‚åŠ  | `join_room()` |
| ãƒ«ãƒ¼ãƒ ä¸€è¦§ã®å–å¾— | `input_room_name()` |
| ãƒ‘ã‚±ãƒƒãƒˆä½œæˆ | `create_packet()` |

#### ğŸ”¹ UDPClient

UDPé€šä¿¡ã‚’ä»‹ã—ã¦ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€å—ä¿¡ã—ã¾ã™ã€‚

| æ©Ÿèƒ½ | èª¬æ˜ |
|------|------|
| ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®é€ä¿¡ | `send_username()` |
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é€ä¿¡ | `send_message()` |
| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å—ä¿¡ | `receive_message()` |
| ãƒ‘ã‚±ãƒƒãƒˆä½œæˆ | `create_packet()` |

---






## âœ¨ ã“ã ã‚ã‚Šã®ãƒã‚¤ãƒ³ãƒˆ

## âš ï¸ è‹¦åŠ´ã—ãŸç‚¹

## ğŸ’¡ ã•ã‚‰ã«è¿½åŠ ã—ãŸã„æ©Ÿèƒ½

## ğŸ“„ å‚è€ƒæ–‡çŒ®
<p align="center">
  <img src="https://github.com/user-attachments/assets/43766c52-7a68-4d7e-852d-18bf48755f78" width="100%">
</p>


# ãƒã‚¤ãƒˆæƒ…å ±




---

## è©³ç´°ä»•æ§˜
- **æ–°è¦ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ä½œæˆæ™‚**
  - æ“ä½œã‚³ãƒ¼ãƒ‰ã¯ `1`
  - çŠ¶æ…‹ã¯ `0 â†’ 1 â†’ 2` ã®é †ã«æ¨ç§»
  - TCPã¯ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã®å®Œå…¨æ€§ã‚’ä¿è¨¼ã™ã‚‹ãŸã‚ã«ä½¿ç”¨
  - çŠ¶æ…‹ã®è©³ç´°ï¼š
    1. **çŠ¶æ…‹ 0ï¼ˆã‚µãƒ¼ãƒã®åˆæœŸåŒ–ï¼‰**: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒãƒ«ãƒ¼ãƒ ä½œæˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ï¼ˆå¸Œæœ›ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å«ã‚€ï¼‰
    2. **çŠ¶æ…‹ 1ï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å¿œç­”ï¼‰**: ã‚µãƒ¼ãƒã¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å«ã‚€ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã§å³åº§ã«å¿œç­”
    3. **çŠ¶æ…‹ 2ï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å®Œäº†ï¼‰**: ã‚µãƒ¼ãƒãŒãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒˆãƒ¼ã‚¯ãƒ³ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸é€ä¿¡ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’è­˜åˆ¥ï¼‰

- **æ—¢å­˜ãƒãƒ£ãƒƒãƒˆãƒ«ãƒ¼ãƒ ã¸ã®å‚åŠ **
  - æ“ä½œã‚³ãƒ¼ãƒ‰ã¯ `2`
  - çŠ¶æ…‹é·ç§»ã¯ãƒ«ãƒ¼ãƒ ä½œæˆæ™‚ã¨åŒã˜
  - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å—ã‘å–ã‚‹ãŒãƒ›ã‚¹ãƒˆã«ã¯ãªã‚‰ãªã„

---

## ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
```json
{
    "operation": 1,
    "state": 0,
    "roomName": "ChatRoom01"
}
```

---

## æ–‡å­—åˆ—ã®æ‰±ã„ã«ã¤ã„ã¦
- `RoomName` ã¯ **UTF-8** ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰/ãƒ‡ã‚³ãƒ¼ãƒ‰ã•ã‚Œã‚‹
- `OperationPayload` ã¯æ“ä½œã¨çŠ¶æ…‹ã«å¿œã˜ã¦ç•°ãªã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆæ•´æ•°ã€æ–‡å­—åˆ—ã€JSONãªã©ï¼‰ã§ãƒ‡ã‚³ãƒ¼ãƒ‰ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹

